(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();class E{constructor(){const e=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname==="";this.isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1||/CriOS/.test(navigator.userAgent)||/FxiOS/.test(navigator.userAgent)||/EdgiOS/.test(navigator.userAgent),e?this.baseUrl="http://localhost:3001/api":this.baseUrl=`${window.location.origin}/api`,this.maxScores=10,console.log(`üåê ScoreDatabase initialized with API URL: ${this.baseUrl}`),console.log(`üîß Environment: ${e?"Development":"Production"}`),console.log(`üì± iOS detected: ${this.isIOS}`),this.isIOS&&console.log("üçé iOS optimizations enabled")}createTimeoutSignal(e){const t=new AbortController;return setTimeout(()=>t.abort(),e),t.signal}async makeRequest(e,t={}){try{const s=`${this.baseUrl}${e}`,r={headers:{"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0",...t.headers},signal:this.createTimeoutSignal(this.isIOS?8e3:1e4),mode:"cors",credentials:"omit",...t};console.log(`üì° Making request to: ${s}`,r);const o=await fetch(s,r);console.log(`üì® Response status: ${o.status} for ${s}`);const a=await o.json();if(!o.ok)throw new Error(a.error||`HTTP ${o.status}`);return a}catch(s){console.error(`‚ùå API request failed for ${this.baseUrl}${e}:`,s);const r=s.name==="TypeError"||s.message.includes("fetch")||s.message.includes("Failed to fetch")||s.message.includes("NetworkError")||s.message.includes("timeout")||s.name==="AbortError",o=s.message.includes("CORS")||s.message.includes("cors");if(r||o||this.isIOS)return console.warn("üçé iOS/Network error detected, falling back to localStorage"),console.warn("üì± Error details:",{name:s.name,message:s.message,userAgent:this.isIOS?"iOS":"Other",isIOS:this.isIOS}),this.fallbackToLocalStorage(e,t);throw s}}fallbackToLocalStorage(e,t){const s="tetris-scores-backup";if(e==="/leaderboard"&&t.method!=="POST")try{const r=localStorage.getItem(s);return{success:!0,data:(r?JSON.parse(r):[]).slice(0,this.maxScores).map((a,n)=>({...a,rank:n+1}))}}catch{return{success:!0,data:[]}}if(e==="/scores"&&t.method==="POST")try{const r=localStorage.getItem(s),o=r?JSON.parse(r):[],a=JSON.parse(t.body);o.push({...a,date:new Date().toISOString(),id:Date.now()}),o.sort((c,m)=>m.score-c.score);const n=o.slice(0,this.maxScores);localStorage.setItem(s,JSON.stringify(n));const l=n.findIndex(c=>c.name===a.name&&c.score===a.score);return{success:!0,data:{rank:l>=0?l+1:-1,madeLeaderboard:l>=0,isNewRecord:l===0,leaderboard:n.map((c,m)=>({...c,rank:m+1}))}}}catch(r){throw console.error("localStorage fallback failed:",r),r}return{success:!1,error:"Operation not supported in fallback mode"}}async getLeaderboard(){try{return(await this.makeRequest("/leaderboard")).data||[]}catch(e){return console.error("Error loading leaderboard:",e),[]}}async addScore(e,t){try{return this.isIOS&&console.log("üçé iOS: Attempting direct API call (Chrome/Safari mode)..."),(await this.makeRequest("/scores",{method:"POST",body:JSON.stringify({name:e.trim()||"Anonymous",score:t})})).data||{rank:-1,madeLeaderboard:!1,isNewRecord:!1,leaderboard:[]}}catch(s){return console.error("Error adding score:",s),this.isIOS?(console.log("üçé iOS: API failed, using localStorage fallback"),this.fallbackToLocalStorage("/scores",{method:"POST",body:JSON.stringify({name:e.trim()||"Anonymous",score:t})})):{rank:-1,madeLeaderboard:!1,isNewRecord:!1,leaderboard:[]}}}async getPlayerStats(e){try{return(await this.makeRequest(`/player/${encodeURIComponent(e)}`)).data||{name:e,bestScore:0,totalGames:0,averageScore:0}}catch(t){return console.error("Error loading player stats:",t),{name:e,bestScore:0,totalGames:0,averageScore:0}}}async wouldMakeLeaderboard(e){try{const t=await this.getLeaderboard();return t.length<this.maxScores?!0:e>t[t.length-1].score}catch(t){return console.error("Error checking leaderboard eligibility:",t),!0}}async clearScores(){try{return(await this.makeRequest("/scores",{method:"DELETE"})).success}catch(e){return console.error("Error clearing scores:",e),!1}}async getPlayerBestScore(e){try{return(await this.getPlayerStats(e)).bestScore}catch(t){return console.error("Error getting player best score:",t),0}}async checkServerHealth(){try{console.log(`üîç Checking server health${this.isIOS?" (iOS mode)":""}...`);const e=this.isIOS?5e3:1e4,s=(await Promise.race([this.makeRequest("/health"),new Promise((r,o)=>setTimeout(()=>o(new Error("Health check timeout")),e))])).success;return console.log(`üíö Server health check: ${s?"PASS":"FAIL"}`),s}catch(e){return console.warn("‚ù§Ô∏è‚Äçü©π Server health check failed:",e.message),this.isIOS&&console.log("üçé iOS fallback mode activated due to health check failure"),!1}}async testConnectivity(){if(!this.isIOS)return!0;try{console.log("üçé Testing iOS connectivity...");const e=Date.now(),t=await this.checkServerHealth(),s=Date.now()-e;return console.log(`üçé iOS connectivity test: ${t?"PASS":"FAIL"} (${s}ms)`),t}catch(e){return console.warn("üçé iOS connectivity test failed:",e),!1}}}const h=10,f=20,i=30,d=1e3,u={LEVEL_1_TO_10:100,LEVEL_11_TO_20:20,LEVEL_21_PLUS:10,MIN_SPEED:50},p={0:"#000000",1:"#FF0000",2:"#00FF00",3:"#0000FF",4:"#FFFF00",5:"#FF00FF",6:"#00FFFF",7:"#FFA500"},y={1:"#FF4444",2:"#44FF44",3:"#4444FF",4:"#FFFF44",5:"#FF44FF",6:"#44FFFF",7:"#FFB844"},S={1:"#CC0000",2:"#00CC00",3:"#0000CC",4:"#CCCC00",5:"#CC00CC",6:"#00CCCC",7:"#CC7700"},v={I:{shape:[[1,1,1,1]],color:1},O:{shape:[[2,2],[2,2]],color:2},T:{shape:[[0,3,0],[3,3,3]],color:3},S:{shape:[[0,4,4],[4,4,0]],color:4},Z:{shape:[[5,5,0],[0,5,5]],color:5},J:{shape:[[6,0,0],[6,6,6]],color:6},L:{shape:[[0,0,7],[7,7,7]],color:7}};class P{constructor(){this.canvas=null,this.ctx=null,this.nextCanvas=null,this.nextCtx=null,this.board=[],this.currentPiece=null,this.nextPiece=null,this.score=0,this.lines=0,this.level=1,this.dropCounter=0,this.dropInterval=d,this.lastTime=0,this.gameRunning=!1,this.gamePaused=!1,this.gameStarted=!1,this.bubbleEffects=[],this.playerName="",this.database=new E,this.lastScoreResult=null,this.serverConnected=!1,this.initBoard(),this.checkServerConnection()}init(){this.canvas=document.getElementById("game-board"),this.ctx=this.canvas.getContext("2d"),this.nextCanvas=document.getElementById("next-piece"),this.nextCtx=this.nextCanvas.getContext("2d"),this.setupEventListeners(),this.render(),this.updateUI(),this.showNameModal()}initBoard(){this.board=Array.from({length:f},()=>Array.from({length:h},()=>0))}setupEventListeners(){document.getElementById("start-btn").addEventListener("click",()=>this.startGame().catch(console.error)),document.getElementById("pause-btn").addEventListener("click",()=>this.togglePause()),document.getElementById("reset-btn").addEventListener("click",()=>this.resetGame()),document.getElementById("restart-btn").addEventListener("click",()=>this.restartGame()),document.getElementById("start-game-btn").addEventListener("click",()=>this.handleNameSubmit()),document.getElementById("show-leaderboard-btn").addEventListener("click",()=>this.showLeaderboard()),document.getElementById("close-leaderboard-btn").addEventListener("click",()=>this.closeLeaderboard()),document.getElementById("player-name").addEventListener("keypress",e=>{e.key==="Enter"&&this.handleNameSubmit()}),document.addEventListener("keydown",e=>this.handleKeyPress(e)),this.setupMobileControls()}handleKeyPress(e){if(!(!this.gameRunning||this.gamePaused))switch(e.code){case"ArrowLeft":e.preventDefault(),this.movePiece(-1,0);break;case"ArrowRight":e.preventDefault(),this.movePiece(1,0);break;case"ArrowDown":e.preventDefault(),this.softDrop();break;case"ArrowUp":e.preventDefault(),this.rotatePiece();break;case"Space":e.preventDefault(),this.hardDrop().catch(console.error);break;case"KeyP":e.preventDefault(),this.togglePause();break}}setupMobileControls(){document.getElementById("mobile-controls"),document.addEventListener("touchstart",a=>{a.target.classList.contains("touch-btn")&&a.preventDefault()},{passive:!1}),document.addEventListener("touchmove",a=>{a.target.classList.contains("touch-btn")&&a.preventDefault()},{passive:!1});const e=document.getElementById("left-btn"),t=document.getElementById("right-btn"),s=document.getElementById("down-btn"),r=document.getElementById("rotate-btn"),o=document.getElementById("hard-drop-btn");e.addEventListener("touchstart",a=>{a.preventDefault(),this.handleMobileInput("left")}),t.addEventListener("touchstart",a=>{a.preventDefault(),this.handleMobileInput("right")}),s.addEventListener("touchstart",a=>{a.preventDefault(),this.handleMobileInput("down")}),r.addEventListener("touchstart",a=>{a.preventDefault(),this.handleMobileInput("rotate")}),o.addEventListener("touchstart",a=>{a.preventDefault(),this.handleMobileInput("hardDrop")}),e.addEventListener("click",a=>{a.preventDefault(),this.handleMobileInput("left")}),t.addEventListener("click",a=>{a.preventDefault(),this.handleMobileInput("right")}),s.addEventListener("click",a=>{a.preventDefault(),this.handleMobileInput("down")}),r.addEventListener("click",a=>{a.preventDefault(),this.handleMobileInput("rotate")}),o.addEventListener("click",a=>{a.preventDefault(),this.handleMobileInput("hardDrop")}),this.setupSwipeGestures()}handleMobileInput(e){if(!(!this.gameRunning||this.gamePaused))switch(e){case"left":this.movePiece(-1,0);break;case"right":this.movePiece(1,0);break;case"down":this.softDrop();break;case"rotate":this.rotatePiece();break;case"hardDrop":this.hardDrop().catch(console.error);break}}setupSwipeGestures(){let e=0,t=0,s=0,r=0;this.canvas.addEventListener("touchstart",o=>{o.preventDefault(),e=o.changedTouches[0].screenX,t=o.changedTouches[0].screenY},{passive:!1}),this.canvas.addEventListener("touchend",o=>{o.preventDefault(),s=o.changedTouches[0].screenX,r=o.changedTouches[0].screenY,this.handleSwipe(e,t,s,r)},{passive:!1})}handleSwipe(e,t,s,r){if(!this.gameRunning||this.gamePaused)return;const o=s-e,a=r-t,n=30;Math.abs(o)>Math.abs(a)?Math.abs(o)>n&&(o>0?this.movePiece(1,0):this.movePiece(-1,0)):Math.abs(a)>n&&(a>0?this.softDrop():this.rotatePiece()),Math.abs(o)<=10&&Math.abs(a)<=10&&this.rotatePiece()}async startGame(){this.gameRunning=!0,this.gameStarted=!0,this.gamePaused=!1,await this.spawnPiece(),this.spawnNextPiece(),this.updateButtons(),this.updateSpeedIndicator(),this.gameLoop()}togglePause(){this.gameStarted&&(this.gamePaused=!this.gamePaused,this.updateButtons(),this.gamePaused||this.gameLoop())}resetGame(){this.gameRunning=!1,this.gameStarted=!1,this.gamePaused=!1,this.score=0,this.lines=0,this.level=1,this.dropInterval=d,this.bubbleEffects=[],this.initBoard(),this.currentPiece=null,this.nextPiece=null,this.hideGameOver(),this.updateButtons(),this.updateUI(),this.updateSpeedIndicator(),this.render()}restartGame(){this.resetGame(),this.hideGameOver(),this.showNameModal()}updateButtons(){const e=document.getElementById("start-btn"),t=document.getElementById("pause-btn");e.disabled=this.gameStarted,t.disabled=!this.gameStarted,t.textContent=this.gamePaused?"Resume":"Pause",this.updateMobileControls()}updateMobileControls(){["left-btn","right-btn","down-btn","rotate-btn","hard-drop-btn"].forEach(t=>{const s=document.getElementById(t);s&&(s.disabled=!this.gameRunning||this.gamePaused)})}async spawnPiece(){this.nextPiece?this.currentPiece=this.nextPiece:this.currentPiece=this.createRandomPiece(),this.spawnNextPiece(),this.checkCollision(this.currentPiece,0,0)&&await this.gameOver()}spawnNextPiece(){this.nextPiece=this.createRandomPiece(),this.renderNextPiece()}createRandomPiece(){const e=Object.keys(v),t=e[Math.floor(Math.random()*e.length)],s=v[t];return{shape:s.shape.map(r=>[...r]),color:s.color,x:Math.floor(h/2)-Math.floor(s.shape[0].length/2),y:0}}movePiece(e,t){this.currentPiece&&(this.checkCollision(this.currentPiece,e,t)||(this.currentPiece.x+=e,this.currentPiece.y+=t,this.render()))}rotatePiece(){if(!this.currentPiece)return;const e=this.rotateMatrix(this.currentPiece.shape),t=this.currentPiece.shape,s=this.currentPiece.x,r=this.currentPiece.y;this.currentPiece.shape=e;const o=this.getWallKicks();for(const a of o)if(this.currentPiece.x=s+a.x,this.currentPiece.y=r+a.y,!this.checkCollision(this.currentPiece,0,0)){this.render();return}this.currentPiece.shape=t,this.currentPiece.x=s,this.currentPiece.y=r}rotateMatrix(e){const t=e.length,s=e[0].length,r=Array.from({length:s},()=>Array(t).fill(0));for(let o=0;o<t;o++)for(let a=0;a<s;a++)r[a][t-1-o]=e[o][a];return r}getWallKicks(){return[{x:0,y:0},{x:-1,y:0},{x:1,y:0},{x:-2,y:0},{x:2,y:0},{x:0,y:-1},{x:-1,y:-1},{x:1,y:-1},{x:0,y:1}]}softDrop(){this.movePiece(0,1)}async hardDrop(){if(this.currentPiece){for(;!this.checkCollision(this.currentPiece,0,1);)this.currentPiece.y++;await this.placePiece()}}checkCollision(e,t,s){const r=e.x+t,o=e.y+s;for(let a=0;a<e.shape.length;a++)for(let n=0;n<e.shape[a].length;n++)if(e.shape[a][n]){const l=r+n,c=o+a;if(l<0||l>=h||c>=f||c>=0&&this.board[c][l])return!0}return!1}async placePiece(){if(this.currentPiece){for(let e=0;e<this.currentPiece.shape.length;e++)for(let t=0;t<this.currentPiece.shape[e].length;t++)if(this.currentPiece.shape[e][t]){const s=this.currentPiece.y+e,r=this.currentPiece.x+t;s>=0&&(this.board[s][r]=this.currentPiece.color)}this.clearLines(),await this.spawnPiece(),this.render()}}clearLines(){let e=0;const t=[];for(let s=f-1;s>=0;s--)this.board[s].every(r=>r!==0)&&(t.push({y:s,colors:[...this.board[s]]}),this.board.splice(s,1),this.board.unshift(Array(h).fill(0)),e++,s++);e>0&&(this.createBubbleEffects(t),this.lines+=e,this.updateScore(e),this.updateLevel(),this.updateUI())}updateScore(e){const t=[0,40,100,300,1200];this.score+=t[e]*this.level}updateLevel(){const e=Math.floor(this.lines/10)+1;if(e>this.level){const t=this.level;this.level=e;let s;this.level<=10?s=d-(this.level-1)*u.LEVEL_1_TO_10:this.level<=20?s=d-9*u.LEVEL_1_TO_10-(this.level-10)*u.LEVEL_11_TO_20:s=d-9*u.LEVEL_1_TO_10-10*u.LEVEL_11_TO_20-(this.level-20)*u.LEVEL_21_PLUS;const r=this.dropInterval;this.dropInterval=Math.max(u.MIN_SPEED,s);const o=Math.round((d-this.dropInterval)/(d-u.MIN_SPEED)*100);console.log(`üéâ Level Up! Level ${t} ‚Üí ${this.level}`),console.log(`‚ö° Speed: ${r}ms ‚Üí ${this.dropInterval}ms (${o}% max speed)`),this.createLevelUpEffect(),this.updateSpeedIndicator()}}createLevelUpEffect(){const e={x:h/2,y:5,text:`LEVEL ${this.level}!`,life:120,color:"#00ffff",size:1.5,type:"levelup"};this.bubbleEffects.push(e)}updateSpeedIndicator(){const e=Math.round((d-this.dropInterval)/(d-u.MIN_SPEED)*100),t=document.getElementById("speed-indicator");t&&(t.textContent=`Speed: ${e}%`,t.style.transform="scale(1.2)",t.style.color="#ff6b6b",setTimeout(()=>{t.style.transform="scale(1)",t.style.color=""},300))}createBubbleEffects(e){e.forEach(t=>{for(let s=0;s<h;s++){const r=t.colors[s];if(r!==0)for(let o=0;o<3;o++)this.bubbleEffects.push({x:s*i+i/2+(Math.random()-.5)*10,y:t.y*i+i/2+(Math.random()-.5)*10,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4-2,size:Math.random()*8+4,color:p[r],alpha:1,life:60,maxLife:60})}})}updateBubbleEffects(){this.bubbleEffects=this.bubbleEffects.filter(e=>e.type==="levelup"?(e.y-=.05,e.life--,e.alpha=e.life/120,e.size+=.01,e.life>0):(e.x+=e.vx,e.y+=e.vy,e.vy+=.1,e.life--,e.alpha=e.life/e.maxLife,e.size*=.98,e.life>0))}drawBubbleEffects(){this.bubbleEffects.forEach(e=>{if(this.ctx.save(),this.ctx.globalAlpha=e.alpha,e.type==="levelup")this.ctx.font=`bold ${e.size*16}px system-ui`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowColor=e.color,this.ctx.shadowBlur=20,this.ctx.fillStyle=e.color,this.ctx.fillText(e.text,e.x*i+i/2,e.y*i+i/2),this.ctx.shadowBlur=0,this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=2,this.ctx.strokeText(e.text,e.x*i+i/2,e.y*i+i/2);else{const t=this.ctx.createRadialGradient(e.x,e.y,0,e.x,e.y,e.size);t.addColorStop(0,e.color+"80"),t.addColorStop(.7,e.color+"40"),t.addColorStop(1,e.color+"00"),this.ctx.fillStyle=t,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.size,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle=e.color+"FF",this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.size*.3,0,Math.PI*2),this.ctx.fill()}this.ctx.restore()})}gameLoop(e=0){if(!this.gameRunning||this.gamePaused)return;const t=e-this.lastTime;this.lastTime=e,this.dropCounter+=t,this.updateBubbleEffects(),this.dropCounter>this.dropInterval&&(this.currentPiece&&(this.checkCollision(this.currentPiece,0,1)?this.placePiece().catch(console.error):(this.currentPiece.y++,this.render())),this.dropCounter=0),this.render(),requestAnimationFrame(s=>this.gameLoop(s))}async gameOver(){this.gameRunning=!1,this.gameStarted=!1,await this.saveScore(),this.showGameOver(),this.updateButtons()}showGameOver(){document.getElementById("final-score").textContent=this.score,document.getElementById("game-over").classList.remove("hidden")}hideGameOver(){document.getElementById("game-over").classList.add("hidden")}showNameModal(){document.getElementById("name-modal").classList.remove("hidden"),document.getElementById("player-name").focus()}hideNameModal(){document.getElementById("name-modal").classList.add("hidden")}handleNameSubmit(){const e=document.getElementById("player-name"),t=e.value.trim();if(t.length===0){alert("Please enter your name!"),e.focus();return}this.playerName=t,this.hideNameModal(),e.value=""}async saveScore(){if(this.playerName&&this.score>0)try{const e=await this.database.addScore(this.playerName,this.score);console.log("Score saved:",e),this.lastScoreResult=e,e.madeLeaderboard&&(e.isNewRecord?console.log("üéâ NEW HIGH SCORE! üéâ"):console.log(`Made the leaderboard at rank #${e.rank}!`))}catch(e){console.error("Failed to save score:",e),this.lastScoreResult=null}}async showLeaderboard(){this.hideGameOver();try{const e=await this.database.getLeaderboard();this.renderLeaderboard(e),document.getElementById("leaderboard-modal").classList.remove("hidden")}catch(e){console.error("Failed to load leaderboard:",e);const t=document.getElementById("leaderboard-list");t.innerHTML='<p style="text-align: center; color: #ff6b6b;">Failed to load leaderboard. Please try again.</p>',document.getElementById("leaderboard-modal").classList.remove("hidden")}}closeLeaderboard(){document.getElementById("leaderboard-modal").classList.add("hidden"),this.showNameModal()}renderLeaderboard(e){const t=document.getElementById("leaderboard-list");if(e.length===0){t.innerHTML='<p style="text-align: center; color: #888;">No scores yet!</p>';return}t.innerHTML=e.map((s,r)=>`
        <div class="${s.name===this.playerName?"leaderboard-entry current-player":"leaderboard-entry"}">
          <span class="leaderboard-rank">#${s.rank}</span>
          <span class="leaderboard-name">${s.name}</span>
          <span class="leaderboard-score">${s.score.toLocaleString()}</span>
        </div>
      `).join("")}async checkServerConnection(){try{console.log("üîç Checking server connection..."),this.serverConnected=await this.database.checkServerHealth(),!this.serverConnected&&this.database.isIOS&&(console.log("üçé iOS: Health check failed, but will attempt API calls with fallback"),this.serverConnected=!0),this.updateServerStatus()}catch(e){console.error("Server connection check failed:",e),this.database.isIOS?(console.log("üçé iOS: Connection check failed, but enabling API attempts with fallback"),this.serverConnected=!0):this.serverConnected=!1,this.updateServerStatus()}}updateServerStatus(){const e=document.getElementById("status-indicator"),t=document.getElementById("status-text");this.serverConnected?(e.className="status-indicator connected",this.database.isIOS?t.textContent="Global Leaderboard (iOS)":t.textContent="Global Leaderboard"):(e.className="status-indicator disconnected",t.textContent="Local Scores Only"),console.log(`Server status: ${this.serverConnected?"Connected":"Offline (using local storage)"}`),this.database.isIOS&&console.log("üçé iOS mode: Will attempt server calls with automatic localStorage fallback")}updateUI(){document.getElementById("score").textContent=this.score,document.getElementById("lines").textContent=this.lines,document.getElementById("level").textContent=this.level}draw3DBlock(e,t,s,r,o){const a=y[o],n=S[o],l=p[o];e.fillStyle=l,e.fillRect(t,s,r,r),e.fillStyle=a,e.fillRect(t,s,r,r*.2),e.fillRect(t,s,r*.2,r),e.fillStyle=n,e.fillRect(t,s+r*.8,r,r*.2),e.fillRect(t+r*.8,s,r*.2,r),e.strokeStyle="#FFFFFF",e.lineWidth=1,e.strokeRect(t,s,r,r)}drawSmall3DBlock(e,t,s,r,o){const a=y[o],n=S[o],l=p[o];e.fillStyle=l,e.fillRect(t,s,r,r);const c=Math.max(1,r*.25),m=Math.max(1,r*.25);e.fillStyle=a,e.fillRect(t,s,r,c),e.fillRect(t,s,c,r),e.fillStyle=n,e.fillRect(t,s+r-m,r,m),e.fillRect(t+r-m,s,m,r),e.strokeStyle="#FFFFFF",e.lineWidth=.5,e.strokeRect(t,s,r,r)}render(){this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawBoard(),this.currentPiece&&this.drawPiece(this.currentPiece,this.ctx),this.drawGrid(),this.drawBubbleEffects()}drawBoard(){for(let e=0;e<f;e++)for(let t=0;t<h;t++)this.board[e][t]&&this.draw3DBlock(this.ctx,t*i,e*i,i,this.board[e][t])}drawPiece(e,t){for(let s=0;s<e.shape.length;s++)for(let r=0;r<e.shape[s].length;r++)if(e.shape[s][r]){const o=(e.x+r)*i,a=(e.y+s)*i;this.draw3DBlock(t,o,a,i,e.color)}}drawGrid(){this.ctx.strokeStyle="#333333",this.ctx.lineWidth=1;for(let e=0;e<=h;e++)this.ctx.beginPath(),this.ctx.moveTo(e*i,0),this.ctx.lineTo(e*i,f*i),this.ctx.stroke();for(let e=0;e<=f;e++)this.ctx.beginPath(),this.ctx.moveTo(0,e*i),this.ctx.lineTo(h*i,e*i),this.ctx.stroke()}renderNextPiece(){if(!this.nextPiece)return;this.nextCtx.fillStyle="#000000",this.nextCtx.fillRect(0,0,this.nextCanvas.width,this.nextCanvas.height);const e=15,t=this.nextPiece.shape[0].length*e,s=this.nextPiece.shape.length*e,r=(this.nextCanvas.width-t)/2,o=(this.nextCanvas.height-s)/2;for(let a=0;a<this.nextPiece.shape.length;a++)for(let n=0;n<this.nextPiece.shape[a].length;n++)this.nextPiece.shape[a][n]&&this.drawSmall3DBlock(this.nextCtx,r+n*e,o+a*e,e,this.nextPiece.color)}}document.addEventListener("DOMContentLoaded",()=>{new P().init()});
