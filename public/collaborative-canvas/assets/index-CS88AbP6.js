(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function s(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(e){if(e.ep)return;e.ep=!0;const r=s(e);fetch(e.href,r)}})();class a{constructor(){this.canvas=null,this.ctx=null,this.isDrawing=!1,this.lastX=0,this.lastY=0,this.currentColor="#000000",this.currentSize=5,this.socket=null,this.userId=this.generateUserId(),this.userName=this.generateUserName(),this.users=new Map,this.cursors=new Map,this.isConnected=!1,this.currentStroke=[],this.strokeId=0,this.lastTouchX=0,this.lastTouchY=0}generateUserId(){return"user_"+Math.random().toString(36).substr(2,9)}generateUserName(){const t=["Creative","Artistic","Colorful","Bold","Bright","Vivid","Dynamic","Elegant"],s=["Artist","Painter","Designer","Creator","Sketcher","Illustrator"];return t[Math.floor(Math.random()*t.length)]+s[Math.floor(Math.random()*s.length)]+Math.floor(Math.random()*100)}init(){this.setupCanvas(),this.setupUI(),this.setupEventListeners(),this.connectToServer(),this.updateConnectionStatus("connecting","Connecting to server...")}setupCanvas(){this.canvas=document.getElementById("drawing-canvas"),this.ctx=this.canvas.getContext("2d"),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()),this.ctx.lineCap="round",this.ctx.lineJoin="round"}resizeCanvas(){const s=this.canvas.parentElement.getBoundingClientRect();this.canvas.width=s.width,this.canvas.height=s.height,this.ctx.lineCap="round",this.ctx.lineJoin="round"}setupUI(){const t=document.getElementById("brush-size"),s=document.getElementById("brush-size-display");t.addEventListener("input",e=>{this.currentSize=parseInt(e.target.value),s.textContent=`${this.currentSize}px`}),document.getElementById("color-picker").addEventListener("change",e=>{this.currentColor=e.target.value}),document.getElementById("clear-canvas").addEventListener("click",()=>{this.clearCanvas()}),document.getElementById("save-canvas").addEventListener("click",()=>{this.saveCanvas()})}setupEventListeners(){this.canvas.addEventListener("mousedown",t=>this.startDrawing(t)),this.canvas.addEventListener("mousemove",t=>this.draw(t)),this.canvas.addEventListener("mouseup",()=>this.stopDrawing()),this.canvas.addEventListener("mouseout",()=>this.stopDrawing()),this.canvas.addEventListener("touchstart",t=>this.handleTouchStart(t),{passive:!1}),this.canvas.addEventListener("touchmove",t=>this.handleTouchMove(t),{passive:!1}),this.canvas.addEventListener("touchend",()=>this.stopDrawing(),{passive:!1}),this.canvas.addEventListener("mousemove",t=>{this.isDrawing||this.sendCursorPosition(t)})}connectToServer(){setTimeout(()=>{this.isConnected=!0,this.updateConnectionStatus("connected","Connected to server"),this.updateUserCount(1),this.addUser(this.userId,this.userName,this.currentColor)},1e3),this.simulateUserActivity()}simulateUserActivity(){setInterval(()=>{if(Math.random()>.7){const t={id:"sim_"+Math.random().toString(36).substr(2,5),name:this.generateUserName(),color:this.getRandomColor()};this.addUser(t.id,t.name,t.color),setTimeout(()=>{this.removeUser(t.id)},1e4+Math.random()*2e4)}},15e3)}getRandomColor(){const t=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F"];return t[Math.floor(Math.random()*t.length)]}startDrawing(t){this.isDrawing=!0;const s=this.canvas.getBoundingClientRect();this.lastX=t.clientX-s.left,this.lastY=t.clientY-s.top,this.currentStroke=[{x:this.lastX,y:this.lastY,color:this.currentColor,size:this.currentSize}],this.strokeId++}draw(t){if(!this.isDrawing)return;const s=this.canvas.getBoundingClientRect(),i=t.clientX-s.left,e=t.clientY-s.top;this.drawLine(this.lastX,this.lastY,i,e,this.currentColor,this.currentSize),this.currentStroke.push({x:i,y:e,color:this.currentColor,size:this.currentSize}),this.sendDrawingData({type:"draw",strokeId:this.strokeId,points:this.currentStroke,userId:this.userId}),this.lastX=i,this.lastY=e}stopDrawing(){this.isDrawing&&(this.isDrawing=!1,this.currentStroke.length>0&&this.sendDrawingData({type:"strokeComplete",strokeId:this.strokeId,points:this.currentStroke,userId:this.userId}),this.currentStroke=[])}handleTouchStart(t){t.preventDefault();const s=t.touches[0],i=this.canvas.getBoundingClientRect();this.isDrawing=!0,this.lastTouchX=s.clientX-i.left,this.lastTouchY=s.clientY-i.top,this.lastX=this.lastTouchX,this.lastY=this.lastTouchY,this.currentStroke=[{x:this.lastX,y:this.lastY,color:this.currentColor,size:this.currentSize}],this.strokeId++}handleTouchMove(t){if(t.preventDefault(),!this.isDrawing)return;const s=t.touches[0],i=this.canvas.getBoundingClientRect(),e=s.clientX-i.left,r=s.clientY-i.top;this.drawLine(this.lastX,this.lastY,e,r,this.currentColor,this.currentSize),this.currentStroke.push({x:e,y:r,color:this.currentColor,size:this.currentSize}),this.sendDrawingData({type:"draw",strokeId:this.strokeId,points:this.currentStroke,userId:this.userId}),this.lastX=e,this.lastY=r}drawLine(t,s,i,e,r,n){this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=r,this.ctx.lineWidth=n,this.ctx.beginPath(),this.ctx.moveTo(t,s),this.ctx.lineTo(i,e),this.ctx.stroke()}sendDrawingData(t){Math.random()>.8&&this.simulateRemoteDrawing()}simulateRemoteDrawing(){const t=this.getRandomColor(),s=3+Math.random()*10,i=Math.random()*this.canvas.width,e=Math.random()*this.canvas.height,r=i+(Math.random()-.5)*100,n=e+(Math.random()-.5)*100;this.drawLine(i,e,r,n,t,s)}sendCursorPosition(t){const s=this.canvas.getBoundingClientRect();t.clientX-s.left,t.clientY-s.top}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.sendDrawingData({type:"clear",userId:this.userId})}saveCanvas(){const t=document.createElement("a");t.download=`collaborative-canvas-${Date.now()}.png`,t.href=this.canvas.toDataURL(),t.click()}updateConnectionStatus(t,s){const i=document.getElementById("status-indicator"),e=document.getElementById("status-text");i.className=`status-indicator ${t}`,e.textContent=s}updateUserCount(t){document.getElementById("user-count").textContent=`${t} user${t!==1?"s":""} online`}addUser(t,s,i){this.users.set(t,{name:s,color:i}),this.updateUsersList(),this.updateUserCount(this.users.size)}removeUser(t){this.users.delete(t),this.removeCursor(t),this.updateUsersList(),this.updateUserCount(this.users.size)}updateUsersList(){const t=document.getElementById("users-list");t.innerHTML="",this.users.forEach((s,i)=>{const e=document.createElement("div");e.className="user-item",e.innerHTML=`
                <div class="user-color" style="background-color: ${s.color}"></div>
                <span>${s.name}</span>
            `,t.appendChild(e)})}showCursor(t,s,i){if(!this.users.has(t))return;const e=this.users.get(t);let r=this.cursors.get(t);r||(r=document.createElement("div"),r.className="user-cursor",r.setAttribute("data-username",e.name),r.style.borderColor=e.color,r.style.backgroundColor=e.color+"40",document.getElementById("cursors-layer").appendChild(r),this.cursors.set(t,r)),r.style.left=s+"px",r.style.top=i+"px",r.style.display="block"}removeCursor(t){const s=this.cursors.get(t);s&&(s.remove(),this.cursors.delete(t))}}document.addEventListener("DOMContentLoaded",()=>{new a().init()});
